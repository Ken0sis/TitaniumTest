var platform=Ti.Platform.osname;exports.ListWindow=function(e){var a=require("ui/AddWindow").AddWindow,t=Ti.UI.createWindow(e),o=Ti.UI.createTableView(),i=e.isDone,r=Ti.UI.createView({width:Titanium.UI.SIZE});if(o.setData(getTableData(i)),(i||"mobileweb"!==platform)&&t.add(o),!i&&"android"!==platform){var l=Ti.UI.createButton({title:"+",font:{fontSize:32,ontFamily:"Arial"}});l.addEventListener("click",function(){(new a).open()}),"mobileweb"===platform?(t.layout="vertical",l.height=40,l.width=40,l.top=0,l.right=10,t.add(l),t.add(o)):(r.add(l),t.setRightNavButton(r))}return o.addEventListener("click",function(e){"[object TiUIButton]"!=e.source&&createConfirmDialog(e.row.id,e.row.title,i).show()}),Ti.App.addEventListener("app:updateTables",function(){o.setData(getTableData(i))}),t};var getTableData=function(e){function a(e){var a={};return a[1]="green",a[2]="orange",a[3]="red",a[e]}for(var t=(require("ui/AddWindow").AddWindow,require("ui/EditWindow").EditWindow),o=require("db"),i=[],r=null,l=o.selectByDone(e),d=[],n=function(e){var a=Ti.UI.createView({height:28,backgroundColor:"#0080f0"}),t=Ti.UI.createLabel({text:e,color:"white",font:{fontSize:15,ontFamily:"HelveticaNeue"},left:11});return a.add(t),a},m=0;m<l.length;m++)-1==d.indexOf(l[m].category)&&d.push(l[m].category);for(var m=0;m<d.length;m++){for(var s=Ti.UI.createTableViewSection({headerView:new n(d[m])}),u=0;u<l.length;u++)if(l[u].category==d[m]){var c=Ti.UI.createButton({right:7,title:0==l[u].goalGuide?"-":l[u].goalGuide,labelID:l[u].taskID,labelItem:l[u].item,goalID:l[u].goalID,height:30,width:53,color:0==l[u].goalGuide?"gray":a(l[u].goalType),font:{fontWeight:"normal",fontFamily:"HelveticaNeue",fontSize:24}});Ti.API.info(l[u].taskID,l[u].done,l[u].goalType),c.addEventListener("click",function(e){return new t(e.source.labelID,e.source.labelItem,e.source.goalID).open(),!1});var T=Ti.UI.createLabel({text:l[u].item,color:"#424242",font:{fontSize:18,fontFamily:"HelveticaNeue"},width:200,ellipsize:!0,wordWrap:!1,horizontalWrap:!1,left:13,top:7,height:15}),f=Ti.UI.createLabel({text:"("+l[u].loadSigma+" hrs), ("+l[u].dueDate+")",color:"gray",font:{fontStyle:"italic",fontSize:10},left:14,top:34,bottom:6,height:Titanium.UI.SIZE}),r=Ti.UI.createTableViewRow({id:l[u].taskID,done:l[u].done,color:"#000",font:{fontWeight:"normal",fontSize:13}});r.add(c),r.add(T),r.add(f),s.add(r)}i.push(s)}return i},createConfirmDialog=function(e,a,t){var o,i,r=require("db");t?(o=["Delete","Cancel"],i=function(a){0===a.index&&(deleteItem(r,e,t),Ti.App.fireEvent("app:updateTables"))}):(o=["Done","Delete","Cancel"],i=function(a){0===a.index?(r.updateItem(e,1),Ti.App.fireEvent("app:updateTables")):1===a.index&&(deleteItem(r,e,t),Ti.App.fireEvent("app:updateTables"))});var l=Ti.UI.createAlertDialog({title:"Change Task Status",message:a,buttonNames:o});return l.addEventListener("click",i),l},deleteItem=function(e,a,t){"mobileweb"===platform?e.deleteItem(a,t):e.deleteItem(a)};